专业版重构待办清单
1. 基础架构与文件系统 (File System & IO)
[x] 建立本地存储规范：

锁定 videos/ 文件夹为唯一数据源，启动时自动扫描该目录下所有视频格式。

实现"同名 JSON"机制：选择 match01.mp4 时，自动在同目录加载或创建 match01.json。

[x] 移除上传模块：

彻底删除 st.file_uploader 相关逻辑，改为侧边栏 st.selectbox 视频切换列表。

[x] 实现自动保存 (Auto-Save)：

任何打点操作（新增/删除事件）都实时触发 JSON 写入，确保进度永不丢失。

2. 精确对齐预览系统 (Precision Preview)
[x] 帧级控制中枢：

增加 st.number_input（整数型），支持直接输入目标帧编号跳转。

实现滑块（Slider）与输入框的双向联动（修改输入框，滑块自动滑过去；反之亦然）。

[x] 步进微调按钮：

增加 [+1帧], [-1帧], [+10帧], [-10帧] 的快捷点击按钮，用于捕捉打击瞬间。

[x] 帧读取优化：

优化 get_video_frame 逻辑，标注期间不执行任何 UI 合成渲染，只读取原始视频帧进行预览，确保操作零延迟。

3. 标注体验与可视化 (Tagging & Visualization)
[x] 事件列表逻辑重构：

修复目前列表不显示的 Bug，增加"删除单个事件"的交互按钮。

[x] 时间轴 Marker 轨道 (核心需求)：

在滑块上方或下方通过可视化手段展示已打点分布。

配色标准：P1 发动攻击（P2 受击）用蓝色/深灰，P2 发动攻击（P1 受击）用红色（具体视渲染逻辑而定，确保视觉一致）。

[x] 快捷跳转：

点击事件列表中的具体条目，预览窗口自动跳转至该事件发生的精确时间/帧。

4. 后台渲染工作流 (Background Rendering)
[x] 渲染与标注解耦：

标注阶段只记录 timestamp，完全不拆帧。

[x] 导出管理器：

在界面下方或侧边栏新增"渲染控制台"。

点击"开始渲染"后，后台启动逐帧合成逻辑：读取帧 -> Engine计算状态 -> Renderer合成UI -> OpenCV写入视频。

[x] 音频闭环处理：

渲染完成后，调用 MoviePy 自动抓取原视频音轨并进行封装，输出最终带音效的 MP4。

5. 交互细节与规范 (UX & Maintenance)
[x] 播放倍速预览 (播放能力)：

实现一个"简易播放模式"：通过 Streamlit 的定时刷新机制，以选定倍速（0.5x, 1x, 2x）连续切换预览帧，辅助定位大致位置。

[x] 修正 Deprecated 警告：

将所有 use_column_width 替换为 use_container_width。

[x] 目录保护：

增加 output/ 和 data/ 目录的自动检测与创建逻辑。

🎨 界面原型设计方案 (Mockup Layout)
左侧边栏：视频文件列表 + 导出按钮。

中心区域：大尺寸原始视频帧预览（无 UI 遮挡）。

下方区域：

第一层：带红蓝 Marker 的可视化事件轴。

第二层：帧位置滑块。

第三层：帧微调按钮 + 帧/时间跳转输入框。

右侧边栏：打点工具（伤害值、Super 勾选）+ 当前视频已标注事件列表。

🧠 逻辑校验点 (Verification)
Q: 为什么标注时不渲染 UI？

A: 实时渲染 UI 会导致拖动滑块时产生计算延迟，影响"精确对齐"的手感。只需在渲染导出时一次性生成即可。

Q: 时间戳记录还是帧记录？

A: 记录时间戳 float 更具通用性，但在渲染时会严格换算为 int(time * fps)。
